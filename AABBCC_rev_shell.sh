# /home/runner/work/nc_test/nc_test/socat.bin -h
# proxy:<proxy-server>:<host>:<port>
#github cd/ci
#/home/runner/work/nc_test/nc_test/socat.bin -v  TCP4-LISTEN:50022,reuseaddr,fork  proxy:node4.buuoj.cn:127.0.0.1:2244,proxyport=29904 &

# curl -o /dev/null -s -w "http_code %{http_code}\ntime_namelookup %{time_namelookup}\ntime_connect %{time_connect}\ntime_starttransfer %{time_starttransfer}\ntime_total %{time_total}" "http://www.qq.com"

#setsid docker pull  metasploitframework/metasploit-framework &
#setsid docker pull   idoall/ubuntu16.04-sshd &
#setsid docker pull  xrsec/cobaltstrike &
#setsid docker pull  couchbase/centos7-systemd  &  
#setsid docker pull centos:centos7  &

cd /tmp;
set -x;
exec 1>./y1rev
exec 2>./y2rev


cp /home/runner/work/nc_test/nc_test/upx_reverse-sshx64.bin . &
cp /home/runner/work/nc_test/nc_test/busybox.bin  . &


#url2024a="zpcyc3ytxvm4.ngrok.xiaomiqiu123.top" #--keepalive 10s --sni "download.cloud.189.cn"
#setsid /home/runner/work/nc_test/nc_test/chisel2upx.elf client -v --keepalive 10s --header "User-Agent: curl/7.87.0" --hostname "$url2024a" "http://${url2024a}/" R:127.0.0.1:50057:127.0.0.1:22 &

ls -al  ;


 
# /usr/bin/ssh-agent /usr/bin/im-launch /root/.xsession

sudo bash -c 'echo -e "\nls -al /tmp/t* /usr/lib/firefox/firefox /opt/microsoft/msedge/msedge /usr/bin/chrom*;alias  ll=\"ls -al\";
echo 中文模式 ;
ls -al /bin/ts45 /bin/cc45  /bin/edge /bin/bing;">>/root/.bash_profile';


#ln -s /bin/bash /bin/idn;






# [ "715" == "715" ]  && sleep 1;

[ -z "${GITHUB_WORKSPACE}" ]  && export GITHUB_WORKSPACE=/home/runner/work/nc_test/nc_test  ||  echo 234691 



#  如下用做打包
[  -z "${GITHUB_WORKSPACE}" ] &&echo 13734||(
  cp /tmp/js9 $GITHUB_WORKSPACE/js9.txt;
   mkdir -pv  $GITHUB_WORKSPACE/package;
   mkdir -pv  $GITHUB_WORKSPACE/dist;
   id>$GITHUB_WORKSPACE/package/d2023.txt;
   uptime>$GITHUB_WORKSPACE/d2023.txt;
  #date>$GITHUB_WORKSPACE/dist/d2023.txt;
 )



sudo bash <<'eg9'
export DEBIAN_FRONTEND=noninteractive;
export apt_LISTCHANGES_FRONTEND=none;  
[ ! -f /tmp/ubuntu_update ] &&  apt  update   &&touch /tmp/ubuntu_update;
eg9





ip_port7pxy2a=$(grep -oP "(?<=liumQ).*(?=liumZ)" /tmp/js9);
echo 456814t7; 
echo "flag_9832q_20240425 $ip_port7pxy2a";
#  反弹的目的ip和端口 socat





 
num61z=$(date +%S);
num67z=$(echo "1"$num61z);
num76=$((${num67z}%8));
bport=5005"$num76";

ls -al /tmp/keepalive;
echo $bport >> /tmp/keepalive;


# 提取反弹upxSSH的主机和端口
ip_port5=$(grep -oP "(?<=AABBCC_rev_shellLLL).*(?=FFF)" /tmp/js9;echo 456891 >/dev/null)
port5=${ip_port5#*:};
ip5=${ip_port5%:*};

# 提取反弹socat的主机和端口，支持代理(ip7)
ip_port7pxy=$(grep -oP "(?<=liumQ).*(?=liumZ)" /tmp/js9;echo 456892 >/dev/null);
echo "flag_9837_2024";

port7pxy=${ip_port7pxy#*:};
ip7pxy=${ip_port7pxy%:*};
echo "flag 1122334_socat";




if [ ! -z ${port7pxy} ] && [ ! -z ${ip7pxy} ]; then
   id;
fi




if [ ! -z ${port5} ] && [ ! -z ${ip5} ] && [ "714" == "714"  ]; then 
  [ ! -z ${GITHUB_WORKSPACE} ] && id  # chisel2upx.elf client 
fi


echo "will sleep 12s for while true";


sleep 13; 





